<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Two Pointers (Opposite Direction) Visualizer</title>
    <style>
      :root {
        --bg: #ffffff;
        --panel: #f7f7fb;
        --card: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --border: #e5e7eb;
        --accent: #2563eb;
        --good: #16a34a;
        --warn: #f59e0b;
        --bad: #dc2626;
        --shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        --radius: 14px;
        --mono:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        --sans:
          ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: var(--sans);
        color: var(--text);
        background: transparent;
      }

      .wrap {
        max-width: 1100px;
        margin: 28px auto 48px;
        padding: 0 18px;
      }

      header {
        display: flex;
        gap: 14px;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 18px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 6px 0;
        letter-spacing: -0.02em;
      }
      .sub {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.45;
        max-width: 64ch;
      }

      .grid {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 14px;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .card .hd {
        padding: 14px 14px 10px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(180deg, #ffffff 0%, #fafaff 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .hd .title {
        font-weight: 650;
        font-size: 13px;
        color: #0b1226;
        letter-spacing: 0.01em;
      }
      .pill {
        font-size: 12px;
        color: var(--muted);
        border: 1px solid var(--border);
        background: #fff;
        padding: 6px 10px;
        border-radius: 999px;
        font-family: var(--mono);
      }

      .card .bd {
        padding: 14px;
      }

      /* Controls */
      .controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px 12px;
        align-items: end;
      }
      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 12px;
        outline: none;
        font-size: 13px;
        background: #fff;
        transition:
          border-color 0.15s ease,
          box-shadow 0.15s ease;
      }
      input[type="text"]:focus,
      input[type="number"]:focus {
        border-color: rgba(37, 99, 235, 0.45);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
      }

      .btnrow {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }
      button {
        border: 1px solid var(--border);
        background: #fff;
        padding: 9px 11px;
        border-radius: 12px;
        font-size: 13px;
        cursor: pointer;
        transition:
          transform 0.06s ease,
          border-color 0.15s ease,
          box-shadow 0.15s ease,
          background 0.15s ease;
        user-select: none;
      }
      button:hover {
        border-color: rgba(37, 99, 235, 0.35);
        box-shadow: 0 6px 18px rgba(37, 99, 235, 0.1);
      }
      button:active {
        transform: translateY(1px);
      }
      button.primary {
        border-color: rgba(37, 99, 235, 0.3);
        background: rgba(37, 99, 235, 0.06);
      }
      button.danger {
        border-color: rgba(220, 38, 38, 0.25);
        background: rgba(220, 38, 38, 0.06);
      }
      button[disabled] {
        opacity: 0.55;
        cursor: not-allowed;
        box-shadow: none !important;
      }

      .speed {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
      }
      input[type="range"] {
        width: 100%;
      }
      .speed .val {
        min-width: 92px;
        text-align: right;
        font-family: var(--mono);
        font-size: 12px;
        color: var(--muted);
      }

      /* Visualizer */
      .vizWrap {
        padding: 14px 14px 10px;
        border: 1px dashed rgba(100, 116, 139, 0.3);
        background: rgba(247, 247, 251, 0.65);
        border-radius: 14px;
      }

      .array {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        align-items: flex-end;
        padding: 12px 8px 6px;
      }

      .cell {
        width: 56px;
        height: 62px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: #fff;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06);
        transition:
          transform 0.18s ease,
          border-color 0.18s ease,
          box-shadow 0.18s ease,
          background 0.18s ease;
        font-family: var(--mono);
        font-size: 14px;
      }

      .cell.dim {
        opacity: 0.55;
        box-shadow: none;
      }

      .cell.activeL {
        border-color: rgba(37, 99, 235, 0.45);
        box-shadow: 0 10px 26px rgba(37, 99, 235, 0.14);
        transform: translateY(-2px);
      }
      .cell.activeR {
        border-color: rgba(245, 158, 11, 0.55);
        box-shadow: 0 10px 26px rgba(245, 158, 11, 0.16);
        transform: translateY(-2px);
      }
      .cell.found {
        border-color: rgba(22, 163, 74, 0.55);
        background: rgba(22, 163, 74, 0.06);
        box-shadow: 0 10px 26px rgba(22, 163, 74, 0.16);
      }

      .ptr {
        position: absolute;
        top: -18px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        align-items: center;
        gap: 6px;
        font-family: var(--mono);
        font-size: 12px;
        padding: 4px 7px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #fff;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
        white-space: nowrap;
      }
      .ptr .tri {
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 8px solid currentColor;
        margin-top: 1px;
      }
      .ptr.left {
        color: var(--accent);
      }
      .ptr.right {
        color: var(--warn);
      }

      .cell.showL .ptr.left {
        display: flex;
      }
      .cell.showR .ptr.right {
        display: flex;
      }

      .meta {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        margin-top: 12px;
      }
      .kv {
        border: 1px solid var(--border);
        background: #fff;
        border-radius: 12px;
        padding: 10px 12px;
      }
      .k {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      .v {
        font-family: var(--mono);
        font-size: 13px;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .statusLine {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #fff;
        font-size: 13px;
        color: var(--text);
        line-height: 1.45;
      }
      .statusLine .tag {
        display: inline-block;
        font-family: var(--mono);
        font-size: 12px;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        margin-right: 8px;
        color: var(--muted);
      }
      .statusLine.good {
        border-color: rgba(22, 163, 74, 0.35);
        background: rgba(22, 163, 74, 0.05);
      }
      .statusLine.bad {
        border-color: rgba(220, 38, 38, 0.3);
        background: rgba(220, 38, 38, 0.05);
      }
      .statusLine.warn {
        border-color: rgba(245, 158, 11, 0.32);
        background: rgba(245, 158, 11, 0.05);
      }

      /* Log */
      .log {
        max-height: 360px;
        overflow: auto;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: #fff;
        padding: 10px;
        font-family: var(--mono);
        font-size: 12px;
        line-height: 1.55;
      }
      .log .row {
        padding: 8px 8px;
        border-bottom: 1px dashed rgba(100, 116, 139, 0.25);
      }
      .log .row:last-child {
        border-bottom: none;
      }
      .log .row .t {
        color: var(--muted);
        margin-right: 8px;
      }
      .log .row .ok {
        color: var(--good);
      }
      .log .row .no {
        color: var(--bad);
      }
      .log .row .mv {
        color: var(--accent);
      }
      .log .row .mv2 {
        color: var(--warn);
      }

      .footnote {
        margin-top: 10px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.45;
      }

      @media (max-width: 920px) {
        .grid {
          grid-template-columns: 1fr;
        }
        header {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="pill" id="pill">O(n) time · O(1) space</div>
      </header>

      <div class="grid">
        <!-- Left: Visual + Controls -->
        <section class="card">
          <div class="hd">
            <div class="title">Controls</div>
            <div class="pill" id="modePill">Mode: Idle</div>
          </div>
          <div class="bd">
            <div class="controls">
              <div>
                <label for="arrInput">Sorted array (comma-separated)</label>
                <input id="arrInput" type="text" value="1, 2, 4, 7, 11, 15" />
              </div>
              <div>
                <label for="targetInput">Target sum</label>
                <input id="targetInput" type="number" value="15" />
              </div>
            </div>

            <div class="btnrow">
              <button class="primary" id="btnLoad">Load / Reset</button>
              <button id="btnExample">Example</button>
              <button id="btnRandom">Random Sorted</button>
              <button id="btnStep" disabled>Step</button>
              <button id="btnPlay" disabled>Play</button>
              <button class="danger" id="btnClearLog">Clear Log</button>
            </div>

            <div class="speed">
              <label
                style="
                  margin: 0;
                  min-width: 60px;
                  color: var(--muted);
                  font-size: 12px;
                "
                >Speed</label
              >
              <input
                id="speedRange"
                type="range"
                min="100"
                max="1400"
                step="50"
                value="650"
              />
              <div class="val" id="speedVal">650 ms/step</div>
            </div>

            <div style="height: 12px"></div>

            <div class="vizWrap">
              <div class="array" id="array"></div>

              <div class="meta">
                <div class="kv">
                  <div class="k">Pointers</div>
                  <div class="v" id="ptrMeta">L=— · R=—</div>
                </div>
                <div class="kv">
                  <div class="k">Current sum</div>
                  <div class="v" id="sumMeta">—</div>
                </div>
                <div class="kv">
                  <div class="k">Iterations</div>
                  <div class="v" id="iterMeta">0</div>
                </div>
              </div>

              <div class="statusLine" id="statusLine">
                <span class="tag">Status</span>
                Load an array and target, then use
                <b>Step</b> or <b>Play</b>.
              </div>

              <div class="footnote">
                Tip: This demo simulates the classic “pair sum in sorted array”
                use-case for opposite-direction two pointers. The same movement
                logic generalizes to many “shrink from both ends” problems.
              </div>
            </div>
          </div>
        </section>

        <!-- Right: Log -->
        <aside class="card">
          <div class="hd">
            <div class="title">Execution Log</div>
            <div class="pill" id="resultPill">Result: —</div>
          </div>
          <div class="bd">
            <div class="log" id="log"></div>
          </div>
        </aside>
      </div>
    </div>

    <script>
      // ===== Utilities =====
      const $ = (id) => document.getElementById(id);
      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

      function parseArray(text) {
        const parts = text
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
        if (parts.length === 0) return [];
        const nums = parts.map((p) => Number(p));
        if (nums.some((n) => Number.isNaN(n)))
          throw new Error("Array contains non-numeric values.");
        return nums;
      }

      function formatPair(arr, l, r) {
        if (l == null || r == null) return "—";
        return `L=${l} (v=${arr[l]}) · R=${r} (v=${arr[r]})`;
      }

      function nowStamp() {
        const d = new Date();
        const hh = String(d.getHours()).padStart(2, "0");
        const mm = String(d.getMinutes()).padStart(2, "0");
        const ss = String(d.getSeconds()).padStart(2, "0");
        return `${hh}:${mm}:${ss}`;
      }

      // ===== State =====
      let state = {
        arr: [],
        target: 0,
        l: null,
        r: null,
        iter: 0,
        found: false,
        done: false,
        foundPair: null, // {l,r}
        autoplay: false,
        timer: null,
        lastAction: "Idle",
      };

      // ===== DOM refs =====
      const arrInput = $("arrInput");
      const targetInput = $("targetInput");
      const arrayEl = $("array");
      const ptrMeta = $("ptrMeta");
      const sumMeta = $("sumMeta");
      const iterMeta = $("iterMeta");
      const statusLine = $("statusLine");
      const logEl = $("log");
      const modePill = $("modePill");
      const resultPill = $("resultPill");

      const btnLoad = $("btnLoad");
      const btnExample = $("btnExample");
      const btnRandom = $("btnRandom");
      const btnStep = $("btnStep");
      const btnPlay = $("btnPlay");
      const btnClearLog = $("btnClearLog");

      const speedRange = $("speedRange");
      const speedVal = $("speedVal");

      // ===== Rendering =====
      function renderArray() {
        arrayEl.innerHTML = "";
        const { arr, l, r, foundPair, done } = state;

        if (arr.length === 0) {
          const empty = document.createElement("div");
          empty.style.color = "var(--muted)";
          empty.style.fontSize = "13px";
          empty.style.padding = "14px 6px";
          empty.textContent = "No array loaded.";
          arrayEl.appendChild(empty);
          return;
        }

        arr.forEach((v, i) => {
          const cell = document.createElement("div");
          cell.className = "cell";

          // pointers
          const ptrL = document.createElement("div");
          ptrL.className = "ptr left";
          ptrL.innerHTML = `<span>L</span><span class="tri"></span>`;

          const ptrR = document.createElement("div");
          ptrR.className = "ptr right";
          ptrR.innerHTML = `<span>R</span><span class="tri"></span>`;

          cell.appendChild(ptrL);
          cell.appendChild(ptrR);

          const txt = document.createElement("div");
          txt.textContent = String(v);
          cell.appendChild(txt);

          // Visual states
          if (l !== null && i === l) cell.classList.add("activeL", "showL");
          if (r !== null && i === r) cell.classList.add("activeR", "showR");

          // If found, mark the pair
          if (foundPair && (i === foundPair.l || i === foundPair.r)) {
            cell.classList.add("found");
          }

          // Dim non-relevant once done
          if (done && !foundPair) {
            // no pair found -> dim all
            cell.classList.add("dim");
          }

          arrayEl.appendChild(cell);
        });
      }

      function renderMeta() {
        const { arr, l, r, iter, done, found, foundPair } = state;

        iterMeta.textContent = String(iter);
        if (arr.length === 0 || l === null || r === null) {
          ptrMeta.textContent = "L=— · R=—";
          sumMeta.textContent = "—";
        } else {
          ptrMeta.textContent = formatPair(arr, l, r);
          const sum = arr[l] + arr[r];
          sumMeta.textContent = `${arr[l]} + ${arr[r]} = ${sum}`;
        }

        modePill.textContent = `Mode: ${done ? "Done" : state.autoplay ? "Playing" : "Ready"}`;

        if (foundPair) {
          resultPill.textContent = `Result: Found (${arr[foundPair.l]}, ${arr[foundPair.r]})`;
        } else if (done && !found) {
          resultPill.textContent = "Result: Not found";
        } else {
          resultPill.textContent = "Result: —";
        }
      }

      function setStatus(kind, tag, message) {
        statusLine.className = "statusLine" + (kind ? ` ${kind}` : "");
        statusLine.innerHTML = `<span class="tag">${tag}</span>${message}`;
      }

      function logLine(html) {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `<span class="t">[${nowStamp()}]</span>${html}`;
        logEl.prepend(row);
      }

      function syncButtons() {
        const ready = state.arr.length > 0 && !state.done;
        btnStep.disabled = !ready || state.autoplay;
        btnPlay.disabled = state.arr.length === 0 || state.done;

        btnPlay.textContent = state.autoplay ? "Pause" : "Play";
      }

      function renderAll() {
        renderArray();
        renderMeta();
        syncButtons();
      }

      // ===== Algorithm simulation (Two pointers opposite direction) =====
      function initRun() {
        stopAutoplay();

        try {
          const arr = parseArray(arrInput.value);
          const target = Number(targetInput.value);

          // Ensure sorted (common for this pattern); keep it explicit.
          const sorted = [...arr].sort((a, b) => a - b);

          state = {
            ...state,
            arr: sorted,
            target: target,
            l: sorted.length ? 0 : null,
            r: sorted.length ? sorted.length - 1 : null,
            iter: 0,
            found: false,
            done: sorted.length < 2, // if 0 or 1 element -> done immediately
            foundPair: null,
            autoplay: false,
            timer: null,
            lastAction: "Initialized",
          };

          if (sorted.length < 2) {
            setStatus(
              "warn",
              "Status",
              "Array must contain at least 2 numbers to run two pointers.",
            );
            logLine(
              `Loaded array (n=${sorted.length}). <span class="no">Cannot run: need ≥ 2 elements.</span>`,
            );
          } else {
            setStatus(
              "",
              "Status",
              `Ready. Using sorted array (n=${sorted.length}). Target = <b>${target}</b>.`,
            );
            logLine(`Loaded array (sorted). Target = <b>${target}</b>.`);
          }

          renderAll();
        } catch (e) {
          setStatus("bad", "Error", e.message);
          logLine(`<span class="no">Error:</span> ${e.message}`);
          state.arr = [];
          state.done = true;
          renderAll();
        }
      }

      function step() {
        if (state.done || state.arr.length < 2) return;

        const { arr, target } = state;
        let { l, r } = state;

        // termination
        if (l >= r) {
          state.done = true;
          state.found = false;
          setStatus("bad", "Done", "Pointers crossed. No pair found.");
          logLine(
            `L=${l}, R=${r}. <span class="no">Stop:</span> pointers crossed. No pair found.`,
          );
          renderAll();
          return;
        }

        const leftVal = arr[l];
        const rightVal = arr[r];
        const sum = leftVal + rightVal;

        state.iter += 1;

        if (sum === target) {
          state.found = true;
          state.done = true;
          state.foundPair = { l, r };
          setStatus(
            "good",
            "Found",
            `Match: <b>${leftVal} + ${rightVal} = ${target}</b> at indices (${l}, ${r}).`,
          );
          logLine(
            `Iter #${state.iter}: Check ${leftVal}+${rightVal}=${sum}. ` +
              `<span class="ok">FOUND</span> at (L=${l}, R=${r}).`,
          );
          renderAll();
          stopAutoplay();
          return;
        }

        if (sum < target) {
          // Need a larger sum -> move left pointer right
          const oldL = l;
          l = l + 1;
          state.l = l;
          setStatus(
            "warn",
            "Move",
            `Sum < target (${sum} < ${target}). Move <b>L →</b> (from ${oldL} to ${l}).`,
          );
          logLine(
            `Iter #${state.iter}: Check ${leftVal}+${rightVal}=${sum} < ${target}. ` +
              `<span class="mv">Move L →</span> (L ${oldL}→${l}).`,
          );
        } else {
          // Need a smaller sum -> move right pointer left
          const oldR = r;
          r = r - 1;
          state.r = r;
          setStatus(
            "warn",
            "Move",
            `Sum > target (${sum} > ${target}). Move <b>R ←</b> (from ${oldR} to ${r}).`,
          );
          logLine(
            `Iter #${state.iter}: Check ${leftVal}+${rightVal}=${sum} > ${target}. ` +
              `<span class="mv2">Move R ←</span> (R ${oldR}→${r}).`,
          );
        }

        // If pointers have crossed after the move, conclude on next step (or now, to be crisp).
        if (state.l >= state.r) {
          // One more render to show final pointer positions, then finalize immediately.
          renderAll();
          state.done = true;
          state.found = false;
          setStatus(
            "bad",
            "Done",
            "Search space exhausted (L ≥ R). No pair found.",
          );
          logLine(
            `After move: L=${state.l}, R=${state.r}. <span class="no">Stop:</span> no pair found.`,
          );
          renderAll();
          stopAutoplay();
          return;
        }

        renderAll();
      }

      function playPause() {
        if (state.arr.length < 2 || state.done) return;

        if (state.autoplay) {
          stopAutoplay();
          setStatus(
            "",
            "Status",
            "Paused. You can continue with Step or Play.",
          );
          renderAll();
          return;
        }

        state.autoplay = true;
        setStatus("", "Status", "Playing…");
        renderAll();

        const tick = () => {
          if (!state.autoplay) return;
          if (state.done) {
            stopAutoplay();
            return;
          }
          step();
          const delay = Number(speedRange.value);
          state.timer = setTimeout(tick, delay);
        };

        const delay = Number(speedRange.value);
        state.timer = setTimeout(tick, delay);
      }

      function stopAutoplay() {
        state.autoplay = false;
        if (state.timer) {
          clearTimeout(state.timer);
          state.timer = null;
        }
        syncButtons();
      }

      // ===== Helpers for demo data =====
      function loadExample() {
        arrInput.value = "1, 2, 4, 7, 11, 15";
        targetInput.value = "15";
        initRun();
      }

      function loadRandom() {
        // random sorted array with n in [7..12], values in [0..40]
        const n = Math.floor(Math.random() * 6) + 7;
        const arr = Array.from({ length: n }, () =>
          Math.floor(Math.random() * 41),
        );
        arr.sort((a, b) => a - b);

        // choose a target that sometimes exists, sometimes not
        let target;
        if (Math.random() < 0.6 && arr.length >= 2) {
          const i = Math.floor(Math.random() * (arr.length - 1));
          const j =
            Math.floor(Math.random() * (arr.length - (i + 1))) + (i + 1);
          target = arr[i] + arr[j];
        } else {
          target = Math.floor(Math.random() * 81);
        }

        arrInput.value = arr.join(", ");
        targetInput.value = String(target);
        initRun();
      }

      // ===== Wiring =====
      btnLoad.addEventListener("click", initRun);
      btnExample.addEventListener("click", loadExample);
      btnRandom.addEventListener("click", loadRandom);
      btnStep.addEventListener("click", step);
      btnPlay.addEventListener("click", playPause);
      btnClearLog.addEventListener("click", () => {
        logEl.innerHTML = "";
      });

      speedRange.addEventListener("input", () => {
        speedVal.textContent = `${speedRange.value} ms/step`;
      });

      // Initial boot
      speedVal.textContent = `${speedRange.value} ms/step`;
      loadExample();
    </script>
  </body>
</html>
